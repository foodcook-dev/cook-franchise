import{a1 as $,n as R,j as n,B as T,t as L,r as j}from"./index-D3Mrkq1w.js";import{A as P,b as U}from"./avatar-DAGrlP71.js";import{D as J,a as O,b as B,c as q,d as G,e as D}from"./dropdown-menu-C96Loi2D.js";import{b as K,A as _}from"./user-auth-B3GK_eKi.js";import{I as Q}from"./IconUser-DuKY7oCh.js";import{S as C,a as E,b as k,c as M,d as b,e as A,f as w}from"./select-DDt7ucFG.js";function W(t,i){let o;try{o=t()}catch{return}return{getItem:c=>{var s;const f=g=>g===null?null:JSON.parse(g,void 0),d=(s=o.getItem(c))!=null?s:null;return d instanceof Promise?d.then(f):f(d)},setItem:(c,s)=>o.setItem(c,JSON.stringify(s,void 0)),removeItem:c=>o.removeItem(c)}}const N=t=>i=>{try{const o=t(i);return o instanceof Promise?o:{then(a){return N(a)(o)},catch(a){return this}}}catch(o){return{then(a){return this},catch(a){return N(a)(o)}}}},X=(t,i)=>(o,a,c)=>{let s={storage:W(()=>localStorage),partialize:e=>e,version:0,merge:(e,l)=>({...l,...e}),...i},f=!1;const d=new Set,g=new Set;let u=s.storage;if(!u)return t((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),o(...e)},a,c);const S=()=>{const e=s.partialize({...a()});return u.setItem(s.name,{state:e,version:s.version})},F=c.setState;c.setState=(e,l)=>{F(e,l),S()};const x=t((...e)=>{o(...e),S()},a,c);c.getInitialState=()=>x;let p;const r=()=>{var e,l;if(!u)return;f=!1,d.forEach(h=>{var v;return h((v=a())!=null?v:x)});const m=((l=s.onRehydrateStorage)==null?void 0:l.call(s,(e=a())!=null?e:x))||void 0;return N(u.getItem.bind(u))(s.name).then(h=>{if(h)if(typeof h.version=="number"&&h.version!==s.version){if(s.migrate){const v=s.migrate(h.state,h.version);return v instanceof Promise?v.then(I=>[!0,I]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,h.state];return[!1,void 0]}).then(h=>{var v;const[I,H]=h;if(p=s.merge(H,(v=a())!=null?v:x),o(p,!0),I)return S()}).then(()=>{m==null||m(p,void 0),p=a(),f=!0,g.forEach(h=>h(p))}).catch(h=>{m==null||m(void 0,h)})};return c.persist={setOptions:e=>{s={...s,...e},e.storage&&(u=e.storage)},clearStorage:()=>{u==null||u.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>r(),hasHydrated:()=>f,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(g.add(e),()=>{g.delete(e)})},s.skipHydration||r(),p||x},Y=X,y=$()(Y(t=>({selectedFranchise:null,selectedStore:null,setSelectedFranchise:i=>t({selectedFranchise:i}),setSelectedStore:i=>t({selectedStore:i}),reset:()=>t({selectedFranchise:null,selectedStore:null})}),{name:"franchise-selected-values"}));function ae({userInfo:t}){const i=R.useTranslations("userNav"),o=y.getState();return n.jsxs(J,{children:[n.jsx(O,{asChild:!0,children:n.jsx(T,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:n.jsx(P,{className:"h-8 w-8",children:n.jsx(U,{children:n.jsx(Q,{size:18})})})})}),n.jsxs(B,{className:"w-56",align:"end",forceMount:!0,children:[n.jsx(q,{className:"font-normal",children:n.jsx("div",{className:"flex flex-col space-y-1",children:n.jsx("p",{className:"text-sm font-medium leading-none",children:t==null?void 0:t.username})})}),n.jsx(G,{}),n.jsx(D,{onClick:async()=>{await K(),o.reset(),sessionStorage.removeItem("franchise-selected-values"),window.location.reload()},children:i("log_out")})]})]})}const Z=async()=>{const t=await _.get("/franchise/franchises/");return t.data?t.data:null},z=async t=>{const i=await _.get(`/franchise/franchises/${t}/sales-companies/`);return i.data?i.data:null},oe=async({page:t=1,franchise_id:i,search:o})=>{let a=`&franchise_id=${i}`;return o&&(a+=`&search_keyword=${o}`),(await _.get(`/product/get-stock-management/?page=${t}${a}`)).data};function le({handleSubmitDate:t,storeShow:i=!0}){const{toast:o}=L(),[a,c]=j.useState([]),[s,f]=j.useState([]),d=y(r=>r.selectedFranchise),g=y(r=>r.setSelectedFranchise),u=y(r=>r.selectedStore),S=y(r=>r.setSelectedStore),F=async()=>{var r,e;try{const l=await Z();l&&c(l==null?void 0:l.franchises)}catch(l){const m=l;console.error("에러:",(r=m==null?void 0:m.response)==null?void 0:r.data.detail),o({variant:"destructive",description:(e=m==null?void 0:m.response)==null?void 0:e.data.detail})}},x=async r=>{if(r==="all"){g(null),f([]),S(null),t&&t({franchiseId:"all",storeInfo:null});return}const e=a==null?void 0:a.find(m=>m.id.toString()===r);console.log("selected:",e),e&&(g(e),S(null),t&&t({franchiseId:r,storeInfo:null}));const l=await z(r);l&&f(l==null?void 0:l.sales_companies)},p=async r=>{if(r==="all"){S(null),t&&t({franchiseId:d==null?void 0:d.id,storeInfo:{id:"all",name:"전체"}});return}const e=s==null?void 0:s.find(l=>l.id.toString()===r);e&&(S(e),t&&t({storeInfo:e}))};return j.useEffect(()=>{F()},[]),j.useEffect(()=>{d&&x(d.id.toString())},[]),j.useEffect(()=>{u&&p(u.id.toString())},[]),n.jsxs(n.Fragment,{children:[n.jsxs(C,{onValueChange:x,value:(d==null?void 0:d.id.toString())??"",children:[n.jsx(E,{className:"w-[180px]",children:n.jsx(k,{placeholder:"프랜차이즈 선택"})}),n.jsx(M,{children:n.jsxs(b,{children:[n.jsx(A,{children:"프랜차이즈 선택"}),n.jsx(w,{value:"all",children:"전체"},"all"),a==null?void 0:a.map(r=>n.jsx(w,{value:r.id.toString(),children:r.name},r.id))]})})]}),i&&n.jsxs(C,{onValueChange:p,value:(u==null?void 0:u.id.toString())??"",children:[n.jsx(E,{className:"w-[180px]",children:n.jsx(k,{placeholder:"가맹점 선택"})}),n.jsx(M,{children:n.jsxs(b,{children:[n.jsx(A,{children:"가맹점 선택"}),n.jsx(w,{value:"all",children:"전체"},"all"),s==null?void 0:s.map(r=>n.jsx(w,{value:r.id.toString(),children:r.name},r.id))]})})]})]})}export{le as F,ae as U,oe as g,y as u};
