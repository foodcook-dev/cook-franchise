import{q as _,m as T,j as a,B as L,s as P,r as y}from"./index-Bdb2VMn6.js";import{A as U,b as B}from"./avatar-CLmIJ18d.js";import{D as J,a as q,b as D,c as G,d as K,e as Q}from"./dropdown-menu-BuUFWeMg.js";import{b as W,A as N}from"./user-auth-b7k2tAEi.js";import{I as X}from"./IconUser-CYAZBS5e.js";import{S as E,a as C,b as k,c as M,d as A,e as H,f as I}from"./select-viZxHBHu.js";const O=e=>{let n;const s=new Set,o=(l,g)=>{const x=typeof l=="function"?l(n):l;if(!Object.is(x,n)){const v=n;n=g??(typeof x!="object"||x===null)?x:Object.assign({},n,x),s.forEach(S=>S(n,v))}},d=()=>n,u={setState:o,getState:d,getInitialState:()=>m,subscribe:l=>(s.add(l),()=>s.delete(l))},m=n=e(o,d,u);return u},Y=e=>e?O(e):O,Z=e=>e;function z(e,n=Z){const s=_.useSyncExternalStore(e.subscribe,()=>n(e.getState()),()=>n(e.getInitialState()));return _.useDebugValue(s),s}const R=e=>{const n=Y(e),s=o=>z(n,o);return Object.assign(s,n),s},V=e=>e?R(e):R;function ee(e,n){let s;try{s=e()}catch{return}return{getItem:d=>{var r;const p=m=>m===null?null:JSON.parse(m,void 0),u=(r=s.getItem(d))!=null?r:null;return u instanceof Promise?u.then(p):p(u)},setItem:(d,r)=>s.setItem(d,JSON.stringify(r,void 0)),removeItem:d=>s.removeItem(d)}}const F=e=>n=>{try{const s=e(n);return s instanceof Promise?s:{then(o){return F(o)(s)},catch(o){return this}}}catch(s){return{then(o){return this},catch(o){return F(o)(s)}}}},te=(e,n)=>(s,o,d)=>{let r={storage:ee(()=>localStorage),partialize:t=>t,version:0,merge:(t,i)=>({...i,...t}),...n},p=!1;const u=new Set,m=new Set;let l=r.storage;if(!l)return e((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),s(...t)},o,d);const g=()=>{const t=r.partialize({...o()});return l.setItem(r.name,{state:t,version:r.version})},x=d.setState;d.setState=(t,i)=>{x(t,i),g()};const v=e((...t)=>{s(...t),g()},o,d);d.getInitialState=()=>v;let S;const c=()=>{var t,i;if(!l)return;p=!1,u.forEach(f=>{var j;return f((j=o())!=null?j:v)});const h=((i=r.onRehydrateStorage)==null?void 0:i.call(r,(t=o())!=null?t:v))||void 0;return F(l.getItem.bind(l))(r.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==r.version){if(r.migrate){const j=r.migrate(f.state,f.version);return j instanceof Promise?j.then(b=>[!0,b]):[!0,j]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var j;const[b,$]=f;if(S=r.merge($,(j=o())!=null?j:v),s(S,!0),b)return g()}).then(()=>{h==null||h(S,void 0),S=o(),p=!0,m.forEach(f=>f(S))}).catch(f=>{h==null||h(void 0,f)})};return d.persist={setOptions:t=>{r={...r,...t},t.storage&&(l=t.storage)},clearStorage:()=>{l==null||l.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>c(),hasHydrated:()=>p,onHydrate:t=>(u.add(t),()=>{u.delete(t)}),onFinishHydration:t=>(m.add(t),()=>{m.delete(t)})},r.skipHydration||c(),S||v},ne=te,w=V()(ne(e=>({selectedFranchise:null,selectedStore:null,setSelectedFranchise:n=>e({selectedFranchise:n}),setSelectedStore:n=>e({selectedStore:n}),reset:()=>e({selectedFranchise:null,selectedStore:null})}),{name:"franchise-selected-values"}));function ue({userInfo:e}){const n=T.useTranslations("userNav"),s=w.getState();return a.jsxs(J,{children:[a.jsx(q,{asChild:!0,children:a.jsx(L,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:a.jsx(U,{className:"h-8 w-8",children:a.jsx(B,{children:a.jsx(X,{size:18})})})})}),a.jsxs(D,{className:"w-56",align:"end",forceMount:!0,children:[a.jsx(G,{className:"font-normal",children:a.jsx("div",{className:"flex flex-col space-y-1",children:a.jsx("p",{className:"text-sm font-medium leading-none",children:e==null?void 0:e.username})})}),a.jsx(K,{}),a.jsx(Q,{onClick:async()=>{await W(),s.reset(),sessionStorage.removeItem("franchise-selected-values"),window.location.reload()},children:n("log_out")})]})]})}const se=async()=>{const e=await N.get("/franchise/franchises/");return e.data?e.data:null},re=async e=>{const n=await N.get(`/franchise/franchises/${e}/sales-companies/`);return n.data?n.data:null},fe=async({page:e=1,franchise_id:n,search:s})=>{let o=`&franchise_id=${n}`;return s&&(o+=`&search_keyword=${s}`),(await N.get(`/product/get-stock-management/?page=${e}${o}`)).data};function he({handleSubmitDate:e,storeShow:n=!0}){const{toast:s}=P(),[o,d]=y.useState([]),[r,p]=y.useState([]),u=w(c=>c.selectedFranchise),m=w(c=>c.setSelectedFranchise),l=w(c=>c.selectedStore),g=w(c=>c.setSelectedStore),x=async()=>{var c,t;try{const i=await se();i&&d(i==null?void 0:i.franchises)}catch(i){const h=i;console.error("에러:",(c=h==null?void 0:h.response)==null?void 0:c.data.detail),s({variant:"destructive",description:(t=h==null?void 0:h.response)==null?void 0:t.data.detail})}},v=async c=>{if(c==="all"){m(null),p([]),g(null),e&&e({franchiseId:"all",storeInfo:null});return}const t=o==null?void 0:o.find(h=>h.id.toString()===c);console.log("selected:",t),t&&(m(t),g(null),e&&e({franchiseId:c,storeInfo:null}));const i=await re(c);i&&p(i==null?void 0:i.sales_companies)},S=async c=>{if(c==="all"){g(null),e&&e({franchiseId:u==null?void 0:u.id,storeInfo:{id:"all",name:"전체"}});return}const t=r==null?void 0:r.find(i=>i.id.toString()===c);t&&(g(t),e&&e({storeInfo:t}))};return y.useEffect(()=>{x()},[]),y.useEffect(()=>{u&&v(u.id.toString())},[]),y.useEffect(()=>{l&&S(l.id.toString())},[]),a.jsxs(a.Fragment,{children:[a.jsxs(E,{onValueChange:v,value:(u==null?void 0:u.id.toString())??"",children:[a.jsx(C,{className:"w-[180px]",children:a.jsx(k,{placeholder:"프랜차이즈 선택"})}),a.jsx(M,{children:a.jsxs(A,{children:[a.jsx(H,{children:"프랜차이즈 선택"}),a.jsx(I,{value:"all",children:"전체"},"all"),o==null?void 0:o.map(c=>a.jsx(I,{value:c.id.toString(),children:c.name},c.id))]})})]}),n&&a.jsxs(E,{onValueChange:S,value:(l==null?void 0:l.id.toString())??"",children:[a.jsx(C,{className:"w-[180px]",children:a.jsx(k,{placeholder:"가맹점 선택"})}),a.jsx(M,{children:a.jsxs(A,{children:[a.jsx(H,{children:"가맹점 선택"}),a.jsx(I,{value:"all",children:"전체"},"all"),r==null?void 0:r.map(c=>a.jsx(I,{value:c.id.toString(),children:c.name},c.id))]})})]})]})}export{he as F,ue as U,fe as g,w as u};
