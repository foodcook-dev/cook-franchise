import{j as e,B as h,M as R,C as V,s as F,c as y,A as v,v as C,w as _,E as A,x as K,y as E,r as m,t as z}from"./index-yJ5CKBzf.js";import{g as L,u as B,F as Q,U}from"./FranchiseSelect-8MamBgdf.js";import{D as M,g as q,b as P,c as O,d as T,h as J,a as $,e as f,L as N}from"./dropdown-menu-B-N1E0nh.js";import{u as G}from"./useInfiniteQuery-Bw_AgOzW.js";import{u as W,f as k,g as X,a as Y,C as D}from"./checkbox-FW6TaFfo.js";import{T as Z,a as ee,b as w,c as se,d as ae,e as I}from"./table-BsAjV4wl.js";import{f as te}from"./format-Ewv89L0A.js";import{I as le}from"./input-8CuSav-B.js";import"./avatar-DZG4ZQ_R.js";import"./user-auth-6fPQi0DF.js";import"./IconUser-aE3FPq9-.js";import"./select-DB69BOJ8.js";import"./index-DQjA0v9-.js";import"./index-nHrg1Ewk.js";const ne=({franchiseId:s,query:a})=>{const{data:t,isLoading:l,isError:r,refetch:o,fetchNextPage:c,hasNextPage:n,isFetchingNextPage:i,isFetching:g,hasPreviousPage:u}=G({queryKey:["franchiseStockList",s,a],queryFn:async({pageParam:x})=>await L({page:x,franchise_id:s,search:a||void 0}),initialPageParam:1,getNextPageParam:(x,j)=>{if(x.next)return j.length+1},enabled:!0});return{franchiseStockList:t,isLoading:l,isError:r,refetch:o,fetchNextPage:c,hasNextPage:n,hasPreviousPage:u,isFetchingNextPage:i,isFetching:g}};function re({table:s}){return e.jsxs(M,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"필터"]})}),e.jsxs(P,{align:"end",className:"w-[150px]",children:[e.jsx(O,{children:"필터"}),e.jsx(T,{}),s.getAllColumns().filter(a=>typeof a.accessorFn<"u"&&a.getCanHide()).map(a=>{var t;return e.jsx(J,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:l=>a.toggleVisibility(!!l),children:((t=a.columnDef.meta)==null?void 0:t.title)||a.id},a.id)})]})]})}function ce({table:s}){const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx("div",{className:"flex gap-x-2"}),a&&e.jsxs(h,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["초기화",e.jsx(V,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(re,{table:s})]})}function ie({columns:s,data:a}){var o;const[t,l]=F.useState([]),r=W({data:a,columns:s,state:{sorting:t},getCoreRowModel:Y(),onSortingChange:l,getSortedRowModel:X()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{table:r}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Z,{children:[e.jsx(ee,{children:r.getHeaderGroups().map(c=>e.jsx(w,{children:c.headers.map(n=>e.jsx(se,{colSpan:n.colSpan,children:n.isPlaceholder?null:k(n.column.columnDef.header,n.getContext())},n.id))},c.id))}),e.jsx(ae,{children:(o=r.getRowModel().rows)!=null&&o.length?r.getRowModel().rows.map(c=>e.jsx(w,{"data-state":c.getIsSelected()&&"selected",children:c.getVisibleCells().map(n=>e.jsx(I,{children:k(n.column.columnDef.cell,n.getContext())},n.id))},c.id)):e.jsx(w,{children:e.jsx(I,{colSpan:s.length,className:"h-24 text-center",children:"데이터가 없습니다."})})})]})})]})}function d({column:s,title:a,className:t}){return s.getCanSort()?e.jsx("div",{className:y("flex items-center space-x-2",t),children:e.jsxs(M,{children:[e.jsx($,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:a}),s.getIsSorted()==="desc"?e.jsx(v,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(C,{className:"ml-2 h-4 w-4"}):e.jsx(_,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(P,{align:"start",children:[e.jsxs(f,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(C,{className:"text-muted-foreground/70 mr-2 h-3.5 w-3.5"}),"Asc"]}),e.jsxs(f,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(v,{className:"text-muted-foreground/70 mr-2 h-3.5 w-3.5"}),"Desc"]}),e.jsx(T,{}),e.jsxs(f,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(A,{className:"text-muted-foreground/70 mr-2 h-3.5 w-3.5"}),"Hide"]})]})]})}):e.jsx("div",{className:y(t),children:a})}const oe=[{id:"select",header:({table:s})=>e.jsx(D,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(D,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsx(d,{column:s,title:"id"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.getValue("id")}),enableSorting:!0,enableHiding:!1},{accessorKey:"product_name",header:({column:s})=>e.jsx(d,{column:s,title:"상품명"}),cell:({row:s})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:s.getValue("product_name")})}),meta:{title:"상품명"},enableSorting:!0,enableHiding:!1},{accessorKey:"branch",header:({column:s})=>e.jsx(d,{column:s,title:"브랜치"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.getValue("branch")}),meta:{title:"브랜치"},enableSorting:!1,enableHiding:!0},{accessorKey:"stock",header:({column:s})=>e.jsx(d,{column:s,title:"재고"}),cell:({row:s})=>{const a=s.getValue("stock"),t=s.getValue("min_stock");return e.jsx("div",{className:"w-[80px]",style:{color:a<t?"red":"#000"},children:a})},meta:{title:"재고"},enableSorting:!0,enableHiding:!1},{accessorKey:"min_stock",header:({column:s})=>e.jsx(d,{column:s,title:"최소 재고"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.getValue("min_stock")}),meta:{title:"최소 재고"}},{accessorKey:"optimal_stock",header:({column:s})=>e.jsx(d,{column:s,title:"적정 재고"}),cell:({row:s})=>e.jsx("div",{className:"w-[80px]",children:s.getValue("optimal_stock")}),meta:{title:"적정 재고"}},{accessorKey:"last_synced_at",header:({column:s})=>e.jsx(d,{column:s,title:"재고 측정시간"}),cell:({row:s})=>e.jsx("div",{className:"w-[120px]",children:te(s.getValue("last_synced_at"),"yy/MM/dd HH:mm:ss")}),meta:{title:"재고 측정시간"}}];function de({totalCount:s,pageSize:a,pageIndex:t,setPageIndex:l,fetchNextPage:r}){return e.jsxs("div",{className:"flex items-center justify-center space-x-4 py-4",children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:["총 개수 ",s??0,"개"]}),e.jsxs(h,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>l(t-1),disabled:t===0,children:[e.jsx("span",{className:"sr-only",children:"이전 페이지"}),e.jsx(K,{className:"h-4 w-4"})]}),e.jsx("span",{className:"text-sm",children:t+1}),e.jsxs(h,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>{r(),l(t+1)},disabled:(t+1)*a>=(s??0),children:[e.jsx("span",{className:"sr-only",children:"다음 페이지"}),e.jsx(E,{className:"h-4 w-4"})]})]})}function xe(s,a){const[t,l]=m.useState(s);return m.useEffect(()=>{const r=setTimeout(()=>{l(s)},a);return()=>{clearTimeout(r)}},[s,a]),t}function ke(){var b,S;const{toast:s}=z(),a=B(p=>p.selectedFranchise),t=JSON.parse(localStorage.getItem("userInfo")||"{}"),[l,r]=m.useState(0),[o,c]=m.useState(""),n=xe(o,300),{franchiseStockList:i,hasNextPage:g,fetchNextPage:u,isFetchingNextPage:x,hasPreviousPage:j}=ne({franchiseId:a?a.id:"",query:n||null}),H=((b=i==null?void 0:i.pages[l])==null?void 0:b.results)||[];return m.useEffect(()=>{if(!a){s({title:"프랜차이즈를 선택해 주세요",description:"프랜차이즈를 선택하지 않으면 재고 목록을 가져올 수 없습니다.",variant:"destructive"});return}},[a]),e.jsxs(N,{children:[e.jsxs(N.Header,{sticky:!0,children:[e.jsx(Q,{storeShow:!1}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsx(U,{userInfo:t})})]}),e.jsxs(N.Body,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"재고 관리"})})}),e.jsx(le,{placeholder:"상품명으로 검색 가능합니다.",className:"mb-4 h-10 w-[250px] lg:w-[400px]",value:o,onChange:p=>{c(p.target.value)}}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(ie,{data:H,columns:oe})}),e.jsx(de,{totalCount:(S=i==null?void 0:i.pages[l])==null?void 0:S.count,pageSize:20,pageIndex:l,setPageIndex:r,hasNextPage:g,hasPreviousPage:j,fetchNextPage:u,isFetchingNextPage:x})]})]})}export{ke as default};
